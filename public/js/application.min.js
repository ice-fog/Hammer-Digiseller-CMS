function init(){$('[data-toggle="tooltip"]').tooltip(),$(".category-widget-sidebar").ntm(),$(".selectpicker").selectpicker({iconBase:"select-icon",tickIcon:"icon-tick"}),$(".category-products .selected").animate({scrollTop:0},"slow"),priceHandler(),cartHandler(),bookmarkHandler(),feedbackHandler(),sortSelectHandler(),subscribeHandler(),shareSiteHandler(),updateCount(),notepadHandler(),chatHandler(),reviewsHandler(),contentHandler(),discountHandler()}function isNumeric(t){return t-0==t&&(""+t).trim().length>0}function setCookie(t,e){$.cookie($.md5(t),encode64(e))}function getCookie(t){var e=$.cookie($.md5(t));return void 0!==e?decode64(e):void 0}function parentWindows(t,e,o){window.open(t,"displayWindow","width="+e+", height="+o+", left=200, top=100, location=no, directories=no, status=no, toolbar=no, menubar=no")}function reviewsHandler(){document.location.href.indexOf("goods")<0||($(document).on("change",".select-reviews-type",function(){getReviews(1)}),getReviews(1),$(document).on("click","#reviews-pagination a",function(){getReviews($(this).attr("id").split("-")[1])}))}function getReviews(t){var e=$(".reviews-container").attr("id").split("-");$(".reviews-container").html(""),$("#reviews-load").removeClass("hidden"),$.post("/ajax",{action:"get-reviews",seller:e[1],goods:e[2],page:isNumeric(t)?t:1,type:$("#type-reviews").find(":selected").val()},function(t){$("#reviews-load").addClass("hidden"),$(".reviews-container").html(t)})}function chatHandler(){$(document).on("click",".btn-chat",function(){var t=$(this).attr("id").split("-");parentWindows("http://www.internet-support.ru/asp/start.asp?fr=g&user="+t[1]+"&service=1&shop=1&lang=ru-RU&id_d="+t[2],800,600)})}function priceHandler(){$(document).on("change","#type_curr",function(){var t=$(this).find(":selected").val(),e=$(this).find(":selected").attr("id").split("-")[1];$(".current-price").html(t+" "+e)})}function notepadHandler(){$(document).on("click",".notepad-open",function(){$.post("/ajax",{action:"get-notepad"},function(t){bootbox.dialog({title:"Блокнот",message:t,buttons:{success:{label:"Сохранить",className:"btn-success",callback:function(){$.post("/ajax",{action:"save-notepad",content:$("#content").val()},function(t){"ok"==t?$.notify("Изменения сохранены!","success"):$.notify("Произошла ошибка!","error")})}},danger:{label:"Отмена",className:"btn-danger",callback:function(){}}}})})})}function sortSelectHandler(){$(document).on("change",".select-order",function(){$.post("/ajax",{action:"set-order",order:$(this).find(":selected").val()},function(t){"ok"==t&&location.reload()})}),$(document).on("change",".select-currency",function(){$.post("/ajax",{action:"set-currency",currency:$(this).find(":selected").val()},function(t){"ok"==t&&location.reload()})})}function bookmarkHandler(){$(document).on("click",".bookmark-open",function(){$.post("/ajax",{action:"get-bookmark"},function(t){bootbox.dialog({title:"Закладки",message:t})})}),$(document).on("click",".bookmark-add",function(){var t=$(this).closest(".content-item"),e=t.attr("id").split("-")[2],o=t.find(".goods-name").text(),n=t.find(".current-price").text();$.post("/ajax",{action:"add-bookmark",id:e,name:o,price:n},function(t){"ok"==t?$.notify("Товар добавлен в закладки!","success"):"in-bookmarks"==t?$.notify("Товар уже добавлен в закладки!","info"):$.notify("При добавлении товара в закладки произошла ошибка","error"),updateCount()})}),$(document).on("click",".bookmark-item-delete",function(){var t=$(this).closest(".bookmark-item").attr("id").split("-")[2];$.post("/ajax",{action:"delete-bookmark",id:t},function(t){$(".bootbox-body").html(t),updateCount()})})}function cartHandler(){$(document).on("click",".cart-open",function(){$.post("/ajax",{action:"get-cart"},function(t){bootbox.dialog({title:"Корзина",message:t,buttons:{success:{label:"Оформить заказ",className:"btn-success",callback:function(){$("#cart-form").submit()}},danger:{label:"Отмена",className:"btn-danger",callback:function(){}}}})})}),$(document).on("click",".cart-add",function(){var t=$(this).closest(".content-item"),e=t.attr("id").split("-")[2],o=t.find(".goods-name").text(),n=t.find(".current-price").text(),a=getCookie("cart-id");$.post("/ajax",{action:"add-cart",id:e,name:o,price:n},function(t){"ok"==t?(t={ID_D:e,Agent:getCookie("agent-id"),TypeCurr:"WMR",TypeCurrAdd:"WMR",lang:"ru-RU",product_id:e},"string"===$.type(a)&&(t.Cart_UID=a),$.post("//shop.digiseller.ru/xml/shop_cart_add.asp?transp=CORS&format=json",t,function(t){t&&t.cart_err?$.notify("При добавлении товара в корзину произошла ошибка","error"):($.notify("Товар добавлен в корзину!","success"),setCookie("cart-id",t.cart_uid))})):"in-cart"==t?$.notify("Товар уже добавлен в корзину!","info"):$.notify("Произошла ошибка!","error"),updateCount()})}),$(document).on("click",".cart-item-delete",function(){var t=$(this).closest(".cart-item").attr("id").split("-")[2],e=getCookie("cart-id");$.ajax("//shop.digiseller.ru/xml/shop_cart_lst.asp?transp=CORS&format=json",{method:"GET",data:{cart_uid:e,item_id:t,product_cnt:0,cart_curr:""},success:function(t){return t?void 0:!1}}),$.post("/ajax",{action:"delete-cart",id:t},function(t){$(".bootbox-body").html(t),updateCount()})})}function updateCount(){$.post("/ajax",{action:"get-count"},function(t){t=JSON.parse(t),$(".cart-count").text(t.cart),$(".bookmark-count").text(t.bookmark)})}function discountHandler(){$("#discount-form").bootstrapValidator({fields:{"discount-email":{validators:{notEmpty:{message:"Не может быть пустым."},emailAddress:{message:"Введите корректный адрес электронной почты."}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$("#discount-load").removeClass("hidden"),$.post("/ajax",$(t.target).serialize()+"&action=get-discount-value",function(t){$("#discount-load").addClass("hidden"),t=JSON.parse(t),"object"==typeof t&&0==t.retval?t.percent>0?$(".discount-value").text("Ваша скидка составляет "+t.percent+"%, стоимость со скидкой составляет "+t.price+" "+t.currency):$(".discount-value").text("Скидка на этот товар вам не доступна!"):$(".discount-value").text("Произошла неизвестная ошибка!")})})}function subscribeHandler(){$("#subscribe-form").bootstrapValidator({fields:{"subscribe-email":{validators:{notEmpty:{message:"Не может быть пустым."},emailAddress:{message:"Введите корректный адрес электронной почты."}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=add-delivery-email",function(e){"already signed"==e?bootbox.alert("Вы уже подписаны на рассылку!"):"ok"==e?(bootbox.alert("Подписка на рассылку оформлена!"),$(t.target).trigger("reset")):bootbox.alert("Произошла неизвестная ошибка!")})})}function feedbackHandler(){$("#feedback-form").bootstrapValidator({fields:{name:{validators:{notEmpty:{message:"Не может быть пустым."}}},email:{validators:{notEmpty:{message:"Не может быть пустым."},emailAddress:{message:"Введите корректный адрес электронной почты."}}},message:{validators:{notEmpty:{message:"Не может быть пустым."}}},captcha:{validators:{notEmpty:{message:"Не может быть пустым."},stringLength:{min:5,max:5,message:"Должен содержать 5 символов."},regexp:{regexp:/^\d+$/,message:"Только целое число"}}}}}).on("success.form.bv",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,$.post("/ajax",$(t.target).serialize()+"&action=send-feedback",function(e){"wrong captcha"==e?($("#captcha").val(""),$("#captcha").closest(".form-group").addClass("has-error")):"ok"==e?(bootbox.alert("Ваше сообщение отправлено!"),$(t.target).trigger("reset")):bootbox.alert("Произошла неизвестная ошибка!")})})}function share(t,e,o){var n="",a=/^(http|https):\/\/([^\/:]+)(:\d*)?([^# ]*)/;switch(e=encodeURIComponent(e),o=encodeURIComponent(o),t){case"fa fa-facebook":n="http://www.facebook.com/sharer.php?s=100&p[summary]="+o+"&p[url]="+e;break;case"fa fa-vk":n="http://vkontakte.ru/share.php?url="+e+"&description="+o+"&noparse=true";break;case"fa fa-odnoklassniki":n="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st.comments="+o+"&st._surl="+e;break;case"fa fa-google-plus":n="https://plus.google.com/share?url="+e}a.test(n)&&parentWindows(n,600,400)}function contentHandler(){$(document).on("click",".share span",function(){var t=$(this).closest("div.content-item"),e=$(this).attr("class"),o=t.attr("id").split("-")[2],n=t.find(".goods-name").html();n=n.length>160?n.substr(0,160)+"...":n,share(e,window.location.protocol+"//"+location.host+"/goods/"+o,n)})}function shareSiteHandler(){$(document).on("click",".share-site i",function(){var t=$(this).attr("class");$.post("/ajax",{action:"get-site-description"},function(e){share(t,window.location.protocol+"//"+location.host,e)})})}